<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è‹±èªæ¸¬é©—</title>
  <style>
    body {
      font-family: "Arial", sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      background-color: #f9f9f9;
    }

    textarea, input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 10px;
    }

    button {
      padding: 10px 20px;
      margin: 5px 5px 10px 0;
      border: none;
      border-radius: 5px;
      background-color: #1976d2;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    #quizSection {
      display: none;
    }

    #options button {
      display: block;
      width: 100%;
      margin: 5px 0;
      background-color: #4caf50;
    }

    #nextBtn {
      background-color: #ff9800;
    }

    #clearBtn {
      background-color: #e53935;
    }

    #submitBtn {
      background-color: #009688;
    }

    #wrongBtn {
      background-color: #9c27b0;
    }

    #clearWrongBtn {
      background-color: #880e4f;
    }

    #timer {
      font-weight: bold;
      color: #d32f2f;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
        font-size: 18px;
      }

      button {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <h2>ğŸŒŸ è‹±èªæ¸¬é©—ç³»çµ±</h2>

  <div id="inputSection">
    <label for="modeSelect">é¸æ“‡é¡Œå‹ï¼š</label>
    <select id="modeSelect">
      <option value="cn2en">ä¸­ç¿»è‹±</option>
      <option value="en2cn">è‹±ç¿»ä¸­</option>
      <option value="spell">æ‹¼å¯«é¡Œ</option>
    </select>
    <p id="lastScore" style="color: gray;"></p>

    <p>è«‹è¼¸å…¥é¡Œåº«è³‡æ–™ï¼ˆæ¯è¡Œæ ¼å¼ç‚ºï¼šè‹±æ–‡,ä¸­æ–‡ï¼‰ï¼š</p>
    <textarea id="dataInput" placeholder="å¦‚ï¼šdetergent,æ´—è¡£ç²‰"></textarea>
    <button onclick="clearData()" id="clearBtn">æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
    <button onclick="clearWrongList()" id="clearWrongBtn">æ¸…é™¤éŒ¯é¡Œæ¸…å–®</button>
    <label for="timeLimitInput">æ¯é¡Œå€’æ•¸æ™‚é–“ï¼ˆç§’ï¼‰ï¼š</label>
    <input type="number" id="timeLimitInput" min="5" max="60" placeholder="ä¾‹å¦‚ï¼š15" />
    <button onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>
    <button onclick="startWrongQuiz()" id="wrongBtn">åªç·´éŒ¯é¡Œ</button>
  </div>

  <div id="quizSection">
    <p id="progress"></p>
    <p id="timer"></p>
    <p id="question" style="font-weight: bold;"></p>
    <div id="options"></div>

    <input id="inputAnswer" type="text" placeholder="è«‹è¼¸å…¥è‹±æ–‡æ‹¼å­—..." style="display:none;" />
    <button id="submitBtn" style="display:none;">é€å‡º</button>

    <p id="feedback"></p>
    <button id="nextBtn" style="display:none;">ä¸‹ä¸€é¡Œ</button>
    <button id="restartBtn" onclick="location.reload()" style="display:none;">é‡æ–°æ¸¬é©—</button>
  </div>

  <script>
    let wordPairs = [], currentQuestion = 0, score = 0, totalQuestions = 10;
    let correctAnswer = "", quizMode = "cn2en", timer, timeLeft = 15;

    function startQuiz() {
      const input = document.getElementById("dataInput").value.trim();
      localStorage.setItem("vocabData", input);
      quizMode = document.getElementById("modeSelect").value;

      let customTime = parseInt(document.getElementById("timeLimitInput").value);
      timeLeft = (isNaN(customTime) || customTime < 5) ? 15 : customTime;

      const lines = input.split("\n").filter(line => line.includes(","));
      wordPairs = shuffle(lines.map(line => {
        const [eng, chn] = line.split(",");
        return { eng: eng.trim(), chn: chn.trim() };
      }));

      if (wordPairs.length < 4) {
        alert("è«‹è‡³å°‘è¼¸å…¥ 4 çµ„ä»¥ä¸Šçš„è³‡æ–™ï¼");
        return;
      }

      totalQuestions = Math.min(10, wordPairs.length);
      wordPairs = wordPairs.slice(0, totalQuestions);
      score = 0;
      currentQuestion = 0;

      document.getElementById("inputSection").style.display = "none";
      document.getElementById("quizSection").style.display = "block";
      generateQuestion();
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function generateQuestion() {
      timeLeft = parseInt(document.getElementById("timeLimitInput").value) || 15;

      const questionElem = document.getElementById("question");
      const optionsElem = document.getElementById("options");
      const feedbackElem = document.getElementById("feedback");
      const progressElem = document.getElementById("progress");
      const nextBtn = document.getElementById("nextBtn");
      const inputAnswer = document.getElementById("inputAnswer");
      const submitBtn = document.getElementById("submitBtn");

      feedbackElem.textContent = "";
      optionsElem.innerHTML = "";
      nextBtn.style.display = "none";
      inputAnswer.style.display = "none";
      submitBtn.style.display = "none";
      inputAnswer.value = "";

      progressElem.textContent = `ç¬¬ ${currentQuestion + 1} é¡Œ / å…± ${totalQuestions} é¡Œ`;

      const correct = wordPairs[currentQuestion];

      if (quizMode === "spell") {
        correctAnswer = correct.eng.toLowerCase();
        questionElem.textContent = `è«‹æ‹¼å‡ºã€Œ${correct.chn}ã€çš„è‹±æ–‡ï¼š`;
        inputAnswer.style.display = "block";
        submitBtn.style.display = "inline";
        inputAnswer.disabled = false;
        submitBtn.disabled = false;
        inputAnswer.focus();

        submitBtn.onclick = () => {
          const userInput = inputAnswer.value.trim().toLowerCase();
          clearInterval(timer);
          if (userInput === correctAnswer) {
            feedbackElem.textContent = "âœ… æ­£ç¢ºï¼";
            feedbackElem.style.color = "green";
            score++;
            removeFromWrongList(correct);
          } else {
            feedbackElem.textContent = `âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
            feedbackElem.style.color = "red";
            saveWrong(correct);
          }
          inputAnswer.disabled = true;
          submitBtn.disabled = true;
          nextBtn.style.display = "inline";
        };
      } else {
        let options = [];
        if (quizMode === "cn2en") {
          correctAnswer = correct.eng;
          questionElem.textContent = `ã€Œ${correct.chn}ã€çš„è‹±æ–‡æ˜¯ï¼Ÿ`;
          options = [correct.eng];
          while (options.length < 4) {
            const rand = wordPairs[Math.floor(Math.random() * wordPairs.length)].eng;
            if (!options.includes(rand)) options.push(rand);
          }
        } else {
          correctAnswer = correct.chn;
          questionElem.textContent = `What is the meaning of "${correct.eng}"ï¼Ÿ`;
          options = [correct.chn];
          while (options.length < 4) {
            const rand = wordPairs[Math.floor(Math.random() * wordPairs.length)].chn;
            if (!options.includes(rand)) options.push(rand);
          }
        }

        shuffle(options);
        options.forEach(opt => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.onclick = () => {
            clearInterval(timer);
            if (opt === correctAnswer) {
              feedbackElem.textContent = "âœ… æ­£ç¢ºï¼";
              feedbackElem.style.color = "green";
              score++;
              removeFromWrongList(correct);
            } else {
              feedbackElem.textContent = `âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
              feedbackElem.style.color = "red";
              saveWrong(correct);
            }
            nextBtn.style.display = "inline";
          };
          optionsElem.appendChild(btn);
        });
      }

      document.getElementById("timer").textContent = `â³ å€’æ•¸è¨ˆæ™‚ï¼š${timeLeft} ç§’`;
      timer = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(timer);
          document.getElementById("timer").textContent = `â° æ™‚é–“åˆ°ï¼`;
          feedbackElem.textContent = `â° æ™‚é–“åˆ°ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
          feedbackElem.style.color = "orange";
          saveWrong(correct);
          nextBtn.style.display = "inline";
          return;
        }

        document.getElementById("timer").textContent = `â³ å€’æ•¸è¨ˆæ™‚ï¼š${timeLeft} ç§’`;
        timeLeft--;
      }, 1000);
    }

    document.getElementById("nextBtn").onclick = () => {
      currentQuestion++;
      if (currentQuestion < totalQuestions) {
        generateQuestion();
      } else {
        document.getElementById("question").textContent = "ğŸ‰ æ¸¬é©—çµæŸï¼";
        document.getElementById("options").innerHTML = "";
        document.getElementById("inputAnswer").style.display = "none";
        document.getElementById("submitBtn").style.display = "none";
        document.getElementById("timer").textContent = "";
        const result = `ä½ ç­”å°äº† <strong>${score}/${totalQuestions}</strong> é¡Œï¼Œæ­£ç¢ºç‡ ${(score / totalQuestions * 100).toFixed(1)}%`;
        document.getElementById("feedback").innerHTML = result;
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("progress").textContent = "";
        document.getElementById("restartBtn").style.display = "inline";
        localStorage.setItem("lastScore", result);
        showLastScore();
      }
    };

    function clearData() {
      localStorage.removeItem("vocabData");
      localStorage.removeItem("lastScore");
      localStorage.removeItem("wrongList");
      document.getElementById("dataInput").value = "";
      document.getElementById("lastScore").textContent = "";
      alert("å·²æ¸…é™¤æ‰€æœ‰å„²å­˜è³‡æ–™ï¼");
    }

    function clearWrongList() {
      localStorage.removeItem("wrongList");
      alert("éŒ¯é¡Œæ¸…å–®å·²æ¸…é™¤ï¼");
    }

    function saveWrong(pair) {
      let wrongList = JSON.parse(localStorage.getItem("wrongList") || "[]");
      if (!wrongList.find(p => p.eng === pair.eng && p.chn === pair.chn)) {
        wrongList.push(pair);
        localStorage.setItem("wrongList", JSON.stringify(wrongList));
      }
    }

    function removeFromWrongList(pair) {
      let wrongList = JSON.parse(localStorage.getItem("wrongList") || "[]");
      wrongList = wrongList.filter(p => !(p.eng === pair.eng && p.chn === pair.chn));
      localStorage.setItem("wrongList", JSON.stringify(wrongList));
    }

    function startWrongQuiz() {
      const storedWrong = localStorage.getItem("wrongList");
      if (!storedWrong) {
        alert("ç›®å‰æ²’æœ‰éŒ¯é¡Œå¯ç·´ç¿’ï¼");
        return;
      }

      let parsed;
      try {
        parsed = JSON.parse(storedWrong);
      } catch (e) {
        alert("éŒ¯èª¤çš„éŒ¯é¡Œè³‡æ–™æ ¼å¼ï¼");
        return;
      }

      if (!Array.isArray(parsed) || parsed.length < 4) {
        alert("éŒ¯é¡Œè³‡æ–™ä¸è¶³ï¼Œè‡³å°‘éœ€ 4 é¡Œæ‰èƒ½é–‹å§‹ï¼");
        return;
      }

      wordPairs = shuffle(parsed.filter(p => p.eng && p.chn));
      totalQuestions = wordPairs.length;
      score = 0;
      currentQuestion = 0;
      quizMode = document.getElementById("modeSelect").value;

      document.getElementById("inputSection").style.display = "none";
      document.getElementById("quizSection").style.display = "block";
      generateQuestion();
    }

    function showLastScore() {
      const savedScore = localStorage.getItem("lastScore");
      if (savedScore) {
        document.getElementById("lastScore").innerHTML = `ğŸ“Š ä¸Šæ¬¡æ¸¬é©—æˆç¸¾ï¼š${savedScore}`;
      }
    }

    window.onload = () => {
      const saved = localStorage.getItem("vocabData");
      if (saved) {
        document.getElementById("dataInput").value = saved;
      }
      showLastScore();
    };
  </script>
</body>
</html>
